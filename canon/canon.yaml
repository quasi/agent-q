# Agent-Q Canon Manifest
# Generated: 2026-01-17
# Method: Multi-source triangulation (7-pass extraction)
# Source: .canon-initiation/pass6-triangulation-report.md

metadata:
  name: "Agent-Q"
  version: "0.3.0"
  description: "AI-powered agentic extension for Common Lisp development"
  canonical_source: "Extracted from existing codebase via triangulation"

  initiation:
    method: "canon-initiate (triangulation v0.2.0)"
    completed: "2026-01-17T13:00:00Z"
    passes: 7
    artifacts_analyzed: 193
    overall_confidence: 0.87

  repository:
    url: "/Users/quasi/quasilabs/projects/agent-q"
    primary_languages:
      - "Common Lisp"
      - "Emacs Lisp"
    framework: "SLY (Superior Lisp Interaction Mode)"

  phases:
    phase1:
      name: "Foundation"
      status: complete
      confidence: 0.95
    phase2:
      name: "Tool System"
      status: complete
      confidence: 0.90
    phase3:
      name: "Autonomous Developer"
      status: partial
      confidence: 0.80
      notes: "Sessions complete; condition/test/kb pending"
    phase4:
      name: "Intelligent Partner"
      status: planned
      confidence: 0.30

# ═══════════════════════════════════════════════════════════════
# FEATURES
# ═══════════════════════════════════════════════════════════════

features:
  # Phase 1 Features (Complete)
  - name: "context-management"
    path: "features/context-management/"
    phase: 1
    status: complete
    confidence: 0.95
    triangulation: convergent
    description: "Code snippet accumulation with 50-item sliding window"
    key_files:
      - "src/context.lisp"
      - "specs/PHASE-1-SPEC.md"
    tests: 20

  - name: "conversation"
    path: "features/conversation/"
    phase: 1
    status: complete
    confidence: 0.90
    triangulation: convergent
    description: "Multi-turn conversation with message history"
    key_files:
      - "src/conversation.lisp"
      - "specs/PHASE-1-SPEC.md"
    tests: "partial (integration only)"

  - name: "session-management"
    path: "features/session-management/"
    phase: 3
    status: complete
    confidence: 0.80
    triangulation: code_only
    description: "SQLite-backed session persistence with CRUD operations"
    key_files:
      - "src/session.lisp"
      - "contrib/sly-agent-q/sly-agent-q-sessions.el"
    tests: 20
    notes: "8 RPC endpoints implemented but not formally specified"

  # Phase 2 Features (Complete)
  - name: "tool-system"
    path: "features/tool-system/"
    phase: 2
    status: complete
    confidence: 0.85
    triangulation: convergent
    description: "Extensible tool registry with 18 tools across 4 categories"
    key_files:
      - "src/tools/*.lisp"
      - "specs/PHASE-2-SPEC.md"
    tests: 0
    spec_adherence: "94% (18/19 tools)"

  - name: "diff-approval"
    path: "features/diff-approval/"
    phase: 2
    status: complete
    confidence: 0.95
    triangulation: convergent
    description: "Per-hunk diff review with unified diff format (v0.3.0)"
    key_files:
      - "src/tools/diff.lisp"
      - "contrib/sly-agent-q/sly-agent-q-diff.el"
      - "docs/DIFF-IMPLEMENTATION.AGENT.md"
    tests: 10
    notes: "Exemplary specification-to-implementation fidelity"

  # Chat Features (Phase 1-3)
  - name: "chat-interface"
    path: "features/chat-interface/"
    phase: 1-3
    status: complete
    confidence: 0.95
    triangulation: convergent
    description: "Interactive chat with markdown rendering and streaming"
    key_files:
      - "contrib/sly-agent-q/sly-agent-q-chat.el"
    tests: 36

  - name: "context-completion"
    path: "features/context-completion/"
    phase: 3
    status: complete
    confidence: 0.95
    triangulation: convergent
    description: "@-mention completion for files, symbols, and buffers"
    key_files:
      - "contrib/sly-agent-q/sly-agent-q-context.el"
      - "docs/guides/context-management.md"
    tests: 99
    notes: "Most comprehensively tested feature (60% of test suite)"

  # Recent Additions (Code-only, need specs)
  - name: "streaming"
    path: "features/streaming/"
    phase: 3
    status: complete
    confidence: 0.75
    triangulation: code_only
    description: "Real-time token-by-token response display"
    key_files:
      - "src/streaming.lisp"
      - "specs/plans/2026-01-13-streaming-observability-upgrade.md"
    tests: "partial"
    needs_spec: true

  - name: "observability"
    path: "features/observability/"
    phase: 3
    status: complete
    confidence: 0.70
    triangulation: code_only
    description: "Logging hooks and metrics collection"
    key_files:
      - "src/observability.lisp"
    tests: 0
    needs_spec: true

  - name: "cost-estimation"
    path: "features/cost-estimation/"
    phase: 3
    status: complete
    confidence: 0.75
    triangulation: code_only
    description: "Pre-flight cost checks and budget enforcement"
    key_files:
      - "src/cost.lisp"
    tests: 0
    needs_spec: true

# ═══════════════════════════════════════════════════════════════
# CORE VOCABULARY
# ═══════════════════════════════════════════════════════════════

vocabulary:
  count: 17
  convergent: 15
  code_only: 2
  source: "core/foundation/vocabulary.md"

# ═══════════════════════════════════════════════════════════════
# DESIGN DECISIONS
# ═══════════════════════════════════════════════════════════════

decisions:
  count: 5
  recovered: 13
  documented: 5
  source: "core/decisions/*.md"
  key_decisions:
    - "0001-session-conversation-unification.md"
    - "0002-streaming-tool-fallback.md"
    - "0003-elisp-first-testing.md"
    - "0004-fail-open-cost-estimation.md"
    - "0005-phased-chat-development.md"

# ═══════════════════════════════════════════════════════════════
# QUALITY METRICS
# ═══════════════════════════════════════════════════════════════

quality:
  spec_adherence: "93%"
  test_coverage:
    elisp: "excellent (165 tests, 100% passing)"
    common_lisp: "none (0 automated tests)"
  documentation_freshness: "high (most updated within 30 days)"
  commit_discipline: "exemplary (root cause analysis)"

  confidence_distribution:
    very_high: 95  # 1.00
    high: 47       # 0.95
    good: 28       # 0.90
    medium: 14     # 0.85
    acceptable: 6  # 0.80
    low: 3         # <0.80

  triangulation_results:
    convergent: 142  # 74%
    code_only: 33    # 17%
    docs_only: 13    # 7%
    conflicts: 5     # 3%

# ═══════════════════════════════════════════════════════════════
# KNOWN GAPS
# ═══════════════════════════════════════════════════════════════

gaps:
  specifications:
    - "Session management RPC endpoints need formal spec"
    - "Streaming/observability/cost need elevation from plans to specs"

  testing:
    - "Common Lisp side has no automated tests"
    - "Tool system untested (18 tools with 0 tests)"
    - "LLM integration untested"

  documentation:
    - ":debug message role undocumented"
    - ":custom context type undocumented"
    - "Concurrency model (single-threaded) undocumented"
    - "REPL history capacity undocumented"

  rationale:
    - ":debug role origin unknown"
    - "Why CL tests were never implemented"

# ═══════════════════════════════════════════════════════════════
# RECOMMENDATIONS
# ═══════════════════════════════════════════════════════════════

recommendations:
  immediate:
    - "Create specs/SESSION-MANAGEMENT-SPEC.md"
    - "Document undocumented properties in core/foundation/"
    - "Create ADRs for recovered design decisions"

  medium_priority:
    - "Elevate streaming/observability/cost plans to formal specs"
    - "Add CL test strategy document"
    - "Update PHASE1-IMPLEMENTATION-SUMMARY.md metrics"

  low_priority:
    - "Add status badges to Phase 3-4 specs"
    - "Investigate :debug role with original author"
    - "Document REPL history capacity"

# ═══════════════════════════════════════════════════════════════
# USAGE NOTES
# ═══════════════════════════════════════════════════════════════

usage:
  reading_canon: |
    Start with core/foundation/vocabulary.md for domain terms.
    Then explore features/ in order of confidence scores.
    High-confidence features (≥0.90) are production-ready.

  updating_canon: |
    When modifying code, update corresponding Canon artifacts.
    Use canon-evolve skill for consistency maintenance.
    Document new decisions in core/decisions/ as ADRs.

  verification: |
    Canon was extracted from working code via triangulation.
    Test suite (165 Elisp tests) verifies Elisp side.
    CL side relies on integration testing (no unit tests).
