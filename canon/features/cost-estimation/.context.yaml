# Context Manifest for cost-estimation
# Generated by canon-specify on 2026-01-21
# Version: 0.5.0

feature: cost-estimation
canon_version: 0.5.0
status: complete
confidence: 0.75

# Summary: What this feature does
summary: |
  Pre-flight cost estimation, budget checking, and session cost tracking
  for LLM requests. Integrates with cl-llm-provider's cost API to calculate
  estimated costs before sending requests, enforce budget limits, and track
  actual session spending based on logged token usage.
  Supports "fail-open" design (ADR-0004): when cost estimation is unavailable,
  operations proceed with warnings rather than blocking the agent.

# Essential context: Always load these for basic understanding
essential:
  - path: "features/cost-estimation/feature.yaml"
    reason: "Feature overview, fail-open design, API surface"
    token_estimate: 900

  - path: "src/cost.lisp"
    reason: "Implementation of estimation, budget checking, session tracking"
    sections: ["Cost Estimation Functions"]
    token_estimate: 1000

# Per-contract context: Load when working on specific contracts
per_contract:
  pre-flight-cost-estimation:
    - path: "src/cost.lisp"
      reason: "Implementation of estimate-request-cost"
      sections: ["estimate-request-cost", "format-cost-usd"]
      token_estimate: 350

  budget-enforcement:
    - path: "src/cost.lisp"
      reason: "Implementation of check-budget and budget-exceeded-error"
      sections: ["Conditions", "check-budget"]
      token_estimate: 400

  session-cost-tracking:
    - path: "src/cost.lisp"
      reason: "Implementation of get-session-cost, format-session-cost"
      sections: ["get-session-cost", "format-session-cost"]
      token_estimate: 600

  cost-formatting:
    - path: "src/cost.lisp"
      reason: "Implementation of format-cost-usd"
      sections: ["format-cost-usd"]
      token_estimate: 150

# Reference context: Load for deep work or related areas
reference:
  - path: "core/decisions/0004-fail-open-cost-estimation.md"
    reason: "ADR explaining fail-open design philosophy"
    token_estimate: 700

  - path: "specs/plans/2026-01-13-streaming-observability-upgrade.md"
    reason: "Implementation plan for cost estimation integration"
    sections: ["Task 3: Add Cost Estimation"]
    token_estimate: 800

# Dependencies: Related features to consider
dependencies:
  - feature: observability
    reason: "Reads *request-log* for actual token usage"

  - feature: chat-interface
    reason: "Displays session cost in header"

# Metadata
generated: 2026-01-21T23:13:00Z
total_token_estimate: 4900
